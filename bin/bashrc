#!/bin/bash
# ~/.config/bash/bin/bashrc

case "$1" in
    init)
        bash "$HOME/.config/bash/setup.sh"
        ;;

    update)
        echo "Updating bash..."
        cd "$HOME/.config/bash" || exit 1
        git pull
        echo "Update complete"
        echo "Run reload to apply changes"
        ;;

    install)
        source "$HOME/.config/bash/bin/lib/os-detect.sh"
        PKG_MGR=$(detect_package_manager)

        if [[ ! -f "$HOME/.config/bash/bin/lib/${PKG_MGR}-packages.sh" ]]; then
            echo "Error: Unsupported package manager: $PKG_MGR"
            echo "No bin/lib/${PKG_MGR}-packages.sh found"
            exit 1
        fi

        # Source the package file (contains arrays + install function)
        source "$HOME/.config/bash/bin/lib/${PKG_MGR}-packages.sh"
        
        case "$2" in
            universal) install_packages "${UNIVERSAL[@]}" ;;
            dev-tools) install_packages "${DEV_TOOLS[@]}" ;;
            all) install_packages "${UNIVERSAL[@]}" "${DEV_TOOLS[@]}" ;;
            *)
                echo "Usage: bashrc install [universal|dev-tools|all]"
                ;;
        esac
        ;;
    
    *)
        echo "Usage: bashrc <command>"
        echo ""
        echo "Commands:"
        echo "  init                               - Interactive setup (workspace, symlinks, dotfiles, packages)"
        echo "  install [universal|dev-tools|all]  - Install packages directly"
        echo "  update                             - Pull latest from GitHub"
        ;;
esac