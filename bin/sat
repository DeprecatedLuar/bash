#!/bin/bash
# ~/.config/bash/bin/sat - Satellite installer for bash config

# Source environment variables
source "$HOME/.config/bash/modules/universal/paths.sh"

case "$1" in
    init)
        bash "$HOME/.config/bash/setup.sh"
        ;;

    update)
        cd "$HOME/.config/bash" || exit 1
        git pull
        ;;

    install)
        if [[ "$2" == "universal" ]] || [[ "$2" == "dev-tools" ]] || [[ "$2" == "all" ]]; then
            # Package installation via satellite (remote)
            curl -sSL "https://raw.githubusercontent.com/$GITHUB_USER/the-satellite/main/satellite.sh" | bash -s -- install-packages "$2"
        elif [[ -n "$2" ]]; then
            # Install from repo's install.sh
            REPO="$2"
            echo "Installing $REPO..."
            curl -sSL "https://raw.githubusercontent.com/$GITHUB_USER/$REPO/main/install.sh" | bash
        else
            echo "Usage: sat install [universal|dev-tools|all|<repo>]"
        fi
        ;;

    clone)
        if [[ -z "$2" ]]; then
            echo "Usage: sat clone <repo> [destination]"
            exit 1
        fi
        REPO="$2"

        if [[ -z "$3" ]]; then
            read -p "Where to clone? (default: ./): " DEST
            DEST="${DEST:-.}"
        else
            DEST="$3"
        fi

        echo "Cloning $GITHUB_USER/$REPO to $DEST..."
        git clone "https://github.com/$GITHUB_USER/$REPO.git" "$DEST/$REPO"
        ;;

    *)
        echo "Usage: sat <command>"
        echo ""
        echo "Commands:"
        echo "  init                               - Interactive setup (workspace, symlinks, dotfiles, packages)"
        echo "  install [universal|dev-tools|all]  - Install system packages"
        echo "  install <repo>                     - Install from repo's install.sh"
        echo "  clone <repo> [dest]                - Clone your repo (default: current dir)"
        echo "  update                             - Pull latest bash config from GitHub"
        ;;
esac